version: '3.8'

services:
  app:
    container_name: ect-chatbot-admin
    build:
      context: .
      dockerfile: Dockerfile
    restart: always
    ports:
      - "3000:3000"
    env_file:
      - .env
    # If you need to access the database on the host machine:
    # 1. If using Docker Desktop (Windows/Mac), use host.docker.internal
    # 2. If using Linux, add extra_hosts like below
    # extra_hosts:
    #   - "host.docker.internal:host-gateway"
    depends_on:
      migrate:
        condition: service_completed_successfully

  migrate:
    container_name: ect-chatbot-migrate
    build:
      context: .
      dockerfile: Dockerfile
      target: migrator
    command: /bin/sh -c "npx prisma migrate deploy && npx prisma db seed"
    env_file:
      - .env
